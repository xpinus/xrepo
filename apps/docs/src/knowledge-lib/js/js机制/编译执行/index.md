# js机制-编译与执行

## 执行栈和执行上下文

> 什么是执行上下文?

"代码执行前进行的准备工作"

当js执行时，当进入到一个环境，就会创建一个执行上下文

**js中的执行环境**
- 全局环境 -- 全局执行上下文
- 函数环境 -- 函数执行上下文
- eval环境 -- eval执行上下文


- 执行上下文的生命周期
    - 创建阶段：函数被调用时，进入函数环境，创建一个函数上下文
      - 函数环境会创建变量对象`VO, Variable Object`
        - arguments 对象（并赋值）
        - 函数声明（并赋值）
        - 变量声明，变量表达式声明（不赋值）
      - 确定 this 指向（由调用者决定）
      - 确定作用域
    - 执行阶段：变量赋值、函数表达式赋值
> 什么是执行栈

js用来管理不同执行上下文的方式

- 执行栈：先进后出
- 栈底永远是全局环境的执行上下文，栈顶永远是正在执行函数的执行上下文
- 当进入一个执行环境，就会创建出它的执行上下文，然后进行压栈
- 数量限制：没有具体限制，但当栈溢出时会报错`maxmum call stack exceeded`

# 作用域和作用域链

- 规定变量和函数的可访问性的范围称作**作用域**
  - 全局作用域：在代码任何位置都能访问到
  - 函数作用域：函数内部
  - 块级作用域，
- 查找变量或者函数时，需要从局部作用域到全局作 用域依次查找，这些作用域的集合称作**作用域链** 
  - 自由变量的取值 = **创建时**作用域链中最靠近的那个变量的取值


## 变量提升和预编译

JS属于解释型语言，在执行过程中顺序执行，但是会分块先预编译然后才执行。因此在JS中存在一种变量提升的现象。

> 变量和函数怎么进行提升的？优先级是怎么样的？

- 对所有函数声明进行提升（除了函数表达式和箭头函数） 
- 引用类型的赋值 
- 开辟堆空间 
- 存储内容 
- 将地址赋给变量 
- 对变量进行提升，只声明，不赋值，值为 undefined

https://juejin.cn/post/6844903575571677198