

# å•é¡µé¢åº”ç”¨çš„é‡å®šå‘

**åœºæ™¯æè¿°**

å¾ˆå¤šç½‘ç«™éƒ½ä¼šæœ‰ç™»å½•æ ¡éªŒï¼Œå…¶æµç¨‹å¦‚ä¸‹ï¼š

1. è®¿é—®ç½‘ç«™ç½‘å€ï¼›
2. æœåŠ¡å™¨å‘çŽ°è¯·æ±‚çš„è¯·æ±‚å¤´æˆ–è€…`Cookie`ä¸­æ²¡æœ‰å¸¦æœ‰ç™»å½•ä¿¡æ¯(ä¸€èˆ¬æ˜¯ä¸€ä¸ª`Token`)ï¼Œå°±è¿”å›žä¸€ä¸ªçŠ¶æ€ç ä¸º`302`çš„é‡å®šå‘å“åº”ï¼Œå¹¶åœ¨å“åº”å¤´çš„`Location`ä¸­å†™å…¥é‡å®šå‘çš„åœ°å€ï¼Œä»Žè€Œè·³è½¬è‡³ç™»é™†é¡µé¢ï¼›
3. æµè§ˆå™¨æŽ¥æ”¶åˆ°å“åº”åŽ**(æ³¨ï¼šå¯¹äºŽ3xxçš„é‡å®šå‘å“åº”ï¼Œaxiosæ— æ³•æ‹¦æˆªï¼Œæ˜¯æµè§ˆå™¨è‡ªåŠ¨å¤„ç†çš„)**ï¼Œå‘çŽ°æ˜¯302ï¼Œå°±ä¼šç”¨ `get` æ–¹æ³•é‡æ–°è¯·æ±‚ Location ä¸­æŒ‡å®šçš„ç™»å½•ç½‘å€ï¼›
4. åœ¨ç™»å½•ç½‘å€è¾“å…¥è´¦å·å¯†ç ç™»å½•åŽï¼ŒæœåŠ¡ç«¯ä¼šåœ¨å“åº”çš„ `Set-Cookie` ä¸­å†™å…¥æˆ‘ä»¬çš„ç™»å½•ä¿¡æ¯ï¼ŒåŒæ—¶æµè§ˆå™¨çš„ä»£ç ä¼šé‡æ–°è·³è½¬åˆ°æˆ‘ä»¬ä¸€å¼€å§‹è®¿é—®çš„é¡µé¢ã€‚

**é—®é¢˜**è¿™é‡Œæˆ‘æ˜¯ä¸€ä¸ªå•é¡µé¢åº”ç”¨ï¼Œä¸€å¼€å§‹ï¼Œæˆ‘çš„è§‚å¯Ÿä¸€ä¸‹å½“åŽç«¯è¿”å›ž302æ—¶ï¼Œæµè§ˆå™¨è¿™è¾¹æ˜¾ç¤ºçŠ¶æ€ç 302ï¼Œlocationå°±æ˜¯å¯¹åº”çš„ç½‘å€ï¼ˆæ— æ•ˆçš„ç½‘å€ä¼šè¿›è¡Œæ‹¼æŽ¥https://juejin.cn/post/6844904151705452552ï¼‰,å¦‚ä¸‹

```
eggåŽç«¯
ctx.redirect('/user/login')

æµè§ˆå™¨æŽ¥æ”¶åˆ°æœåŠ¡å™¨å“åº”ä¸º
Status Code: 302 Found
location: /user/login
ç„¶åŽä¼šè‡ªåŠ¨å‘èµ·ä¸€ä¸ªgetè¯·æ±‚
http://localhost:8000/user/login
```

**å‡ºçŽ°é—®é¢˜1**ï¼šå‘é€äº†è¯·æ±‚ä½†é¡µé¢æ²¡è·³è½¬åˆ°ç™»å½•é¡µå•Šï¼Ÿï¼ˆåˆå§‹é¡µä¸æ˜¯ç™»å½•é¡µï¼‰

åŽŸå› ï¼šå•é¡µé¢åº”ç”¨çš„é¡µé¢æ˜¯é historyæˆ–è€…hashåˆ‡æ¢çš„ï¼Œæµè§ˆå™¨å‘èµ·çš„è¯·æ±‚å¹¶ä¸ä¼šæ”¹å˜é¡µé¢

ðŸ™„å¥½å§ï¼Œæˆ‘æƒ³è¿™é—®é¢˜ä¹Ÿå¥½è§£å†³ï¼Œå’±ä¹ˆå†™ä¸ªaxiosæ‹¦æˆªå™¨ï¼Œåˆ¤æ–­ä¸‹è¿™æ¬¡è¿”å›žæ˜¯å¦æ˜¯ä¸ª302ç„¶åŽæ‰‹åŠ¨è·³è½¬ä¸å°±è¡Œäº†ï¼Œç»“æžœè¯•äº†ä¸€ä¸‹ï¼Œda mei

**é—®é¢˜2**ï¼šå‘çŽ°axiosæ ¹æœ¬æ‹¦æˆªä¸åˆ°302ï¼Œ**å¯¹äºŽ3xxçš„é‡å®šå‘éƒ½æ˜¯ç”±æµè§ˆå™¨è‡ªåŠ¨å¤„ç†çš„**([Axios å“åº”ä¸èƒ½æ‹¦æˆª 302 çŠ¶æ€ç ï¼Ÿ](https://juejin.cn/post/6889782338115207182))ï¼Œè¿™...

## è§£å†³æ–¹å¼1 ä¸ä½¿ç”¨302

ä¸ŽåŽç«¯æ²Ÿé€šï¼ˆè¿™é‡Œå°±æ˜¯å’Œæˆ‘è‡ªå·±æ²Ÿé€šðŸ˜‘ï¼‰

é‡åˆ°é‡å®šå‘ï¼Œä½¿ç”¨å¦‚`401`ï¼Œæ‰‹åŠ¨è®¾ç½®locationï¼Œç„¶åŽå‰ç«¯æ‹¦æˆª`401`æ ¹æ®`location`è¿›è¡Œæ‰‹åŠ¨è·³è½¬

## è§£å†³æ–¹å¼2 reponseUrl

é™åˆ¶ï¼šé‡å®šå‘åŽçš„é¡µé¢è¦ä¿è¯æ­£å¸¸è¿”å›ž

ä¸ç”¨æ‰¾åŽç«¯äº†ï¼Œæµè§ˆå™¨åœ¨é‡åˆ°302åŽè‡ªåŠ¨å‘èµ·ä¸€ä¸ªgetè¯·æ±‚ï¼Œé€šè¿‡axiosçš„responseæ‹¦æˆªå™¨ï¼Œå‘çŽ°res.request.responseUrlå°±æ˜¯é‡å®šå‘çš„urlï¼Œä»Žè€Œå¯ä»¥åˆ¤æ–­æ˜¯å¦å‘ç”Ÿè¿‡é‡å®šå‘ï¼Œç„¶åŽæ‰‹åŠ¨è·³è½¬

```json
{
    ...
    request:  {
        ...
    	responseURL: "http://localhost:8000/user/login"
    	...
	}	...
}
```

## è§£å†³æ–¹å¼3 çº¦å®šurlå‚æ•°

åœ¨302æ—¶çº¦å®šåœ¨urlä¸Šæºå¸¦å‚æ•°å¦‚_redirect_urlï¼Œå‰ç«¯åœ¨è¿›å…¥é¡µé¢æ˜¯æ£€æŸ¥å‚æ•°ï¼Œåˆ¤æ–­æ˜¯å¦å‘ç”Ÿé‡å®šå‘

## è§£å†³æ–¹å¼4 fetch

`redirect: 'manual'`ï¼šé˜»æ­¢ fetch è‡ªåŠ¨è·Ÿéšé‡å®šå‘ã€‚

```js
fetch('https://example.com/some-url', {
  redirect: 'manual' // é˜»æ­¢ fetch è‡ªåŠ¨é‡å®šå‘
})
.then(response => {
  if (response.status === 302) {
    const location = response.headers.get('Location'); // èŽ·å–é‡å®šå‘ç›®æ ‡
    console.log('é‡å®šå‘ç›®æ ‡:', location);

    // å¦‚æžœéœ€è¦ï¼Œå¯ä»¥æ‰‹åŠ¨è·³è½¬
    // window.location.href = location;
  } else {
    return response.json(); // å¤„ç†å…¶ä»–å“åº”
  }
})
.then(data => {
  console.log('å“åº”æ•°æ®:', data);
})
.catch(error => {
  console.error('è¯·æ±‚å¤±è´¥:', error);
});
```